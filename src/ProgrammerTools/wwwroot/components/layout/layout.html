<div class="page-layout">
    <div class="page-layout-nav">
        <Drawer v-if="isSmall" placement="left" :closable="false" v-model="isMenuOpen">
            <template #header>
                <div class="page-layout-brand">
                    <Icon type="ios-hammer-outline" size="24" />
                    <span>{{$t('appName')}}</span>
                    <Icon type="ios-close" size="24" @click="isMenuOpen=false" />
                </div>
            </template>
            <div class="page-layout-nav-body">
                <div class="menu">
                    <Menu ref="menu" accordion="true" theme="dark" width="200" @on-select="nav" :active-name="currentMenuId" :open-names="openMenuArray">
                        <menuitem v-for="menu in menus" v-bind:item="menu"></menuitem>
                    </Menu>
                </div>
                <div class="version">
                    <p>v{{currentVersion.version}}</p>
                    <Button size="small" icon="md-arrow-up" shape="circle" ghost @click="showVersionModal=true"></Button>
                </div>
            </div>
        </Drawer>

        <div v-else v-bind:class="['large',isMenuOpen?'show':'hide']">
            <div class="page-layout-brand">
                <Icon type="ios-hammer-outline" size="24" />
                <span>{{$t('appName')}}</span>
                <Icon type="ios-close" size="24" @click="isMenuOpen=false" />
            </div>
            <div class="page-layout-nav-body">
                <div class="menu">
                    <Menu ref="menu" accordion="true" theme="dark" width="300" @on-select="nav" :active-name="currentMenuId" :open-names="openMenuArray">
                        <menuitem v-for="menu in menus" v-bind:item="menu"></menuitem>
                    </Menu>
                </div>
                <div class="version">
                    <p>v{{currentVersion.version}}</p>
                    <Button size="small" icon="md-arrow-up" shape="circle" ghost @click="showVersion"></Button>
                </div>
            </div>
        </div>

        <Modal v-model="showVersionModal" :mask-closable="false" footer-hide="true" width="250">
            <template #header>
                <p style="color:#f60;text-align:center">
                    <Icon type="md-arrow-up"></Icon>
                    <span>{{$t('message.checkUpdate')}}</span>
                </p>
            </template>
            <div class="versionModalBody">
                <div style="display:grid;grid-template-columns:auto 1fr;grid-template-rows:repeat(4,auto)">
                    <p style="grid-row:1;grid-column:1;text-align:right;padding-right:.5rem;">{{$t('message.platform')}}:</p>
                    <p style="grid-row:1;grid-column:2;font-weight:bold;">{{currentVersion.platform}}</p>

                    <p style="grid-row:2;grid-column:1;text-align:right;padding-right:.5rem;">{{$t('message.currentVersion')}}:</p>
                    <p style="grid-row:2;grid-column:2;font-weight:bold;">v{{currentVersion.version}}</p>

                    <p v-if="lastVersion" style="grid-row:3;grid-column:1;text-align:right;padding-right:.5rem;">{{$t('message.lastVersion')}}:</p>
                    <p v-if="lastVersion" style="grid-row:3;grid-column:2;font-weight:bold;">v{{lastVersion}}</p>

                    <p v-if="lastVersion==currentVersion.version" style="grid-row:4;grid-column:1/3;font-weight:bold;">{{$t('message.alreadyUptodate')}}<Icon color="var(--success)" type="ios-checkmark-circle" /></p>
                    <p v-if="lastVersion&&lastVersion!=currentVersion.version" style="grid-row:4;grid-column:1/3;font-weight:bold;">{{$t('message.newVersionDetected')}}</p>
                </div>
                <div v-if="progress" class="progress">
                    <Progress :percent="progress.progress" status="active">
                        <span>{{$t('message.progress')}}:{{progress.progressString}}&nbsp;&nbsp;{{$t('message.downloadSpeed')}}:{{progress.speed}}</span>
                    </Progress>
                </div>
                <div class="operations">
                    <Button v-if="!lastVersion||lastVersion==currentVersion.version" type="primary" @click="checkUpdate" :loading="checking">{{$t('message.checkUpdate')}}</Button>
                    <Button v-else type="success" @click="upgrade" :loading="upgrading||installing">{{$t('message.installUpdate')}}</Button>
                </div>
            </div>
        </Modal>
    </div>

    <div class="page-layout-header">
        <div class="content start">
            <Space v-if="!isMenuOpen">
                <Icon type="ios-menu" @click="isMenuOpen=true" size="20" color="var(--orange-500)" />
                <Icon type="ios-hammer-outline" size="24" />
                <span>{{$t('appName')}}</span>
            </Space>
        </div>
        <div class="content center">
        </div>
        <div class="content end">
            <Space>
                <Dropdown trigger="click" @on-click="selectLocale">
                    <Button type="primary" size="small">
                        {{$i18n.locale}}
                        <Icon type="ios-arrow-down"></Icon>
                    </Button>
                    <template #list>
                        <DropdownMenu>
                            <DropdownItem v-for="locale in $i18n.availableLocales" v-bind:name="locale" v-bind:selected="locale==$i18n.locale">{{ locale }}</DropdownItem>
                        </DropdownMenu>
                    </template>
                </Dropdown>
                <Icon type="logo-github" @click="openGithub" size="24" />
            </Space>
        </div>
    </div>

    <div class="page-layout-route-tabs">
        <Tabs type="card" :draggable="true" @on-drag-drop="handleDragDrop" closable @on-tab-remove="handleTabRemove" v-model:model-value="currentTabName">
            <TabPane v-for="(tab, index) in tabList" :index="index" :label="$t('menus.'+tab.name)" :name="tab.name" :closable="tabList.length>1" v-bind:data-id="tab.id" />
        </Tabs>
    </div>

    <div class="page-layout-body">
        <div class="page-layout-body-content">
            <slot></slot>
        </div>
    </div>
</div>

